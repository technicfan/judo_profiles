{% extends "new.html" %}

{% block hidden_data2 %}
    <ul id="hidden_own">
        {% for t in own_techniques %}
            <li class="own_data"
                data-id="{{ t.id }}"
                data-technique="{{ t.technique.id }}"
                data-left="{{ t.left_position.number }}"
                data-right="{{ t.right_position.number }}"
                data-state="{{ t.state }}"
                data-side="{% if t.side %}l{% else %}r{% endif %}"
                data-direction="{{ t.direction }}"
            ></li>
        {% endfor %}
    </ul>
    <ul id="hidden_pos">
        {% for p in positions %}
            <li class="pos_data"
                data-id="p{% if p.side %}L{% else %}R{% endif %}{{ p.number }}"
                data-y="{{ p.y }}"
                data-x="{{ p.x }}"
                data-model_id="{{ p.id }}"
            ></li>
        {% endfor %}
    </ul>
    <ul id="hidden_ranks">
        {% for item in technique_ranks %}
            <li class="rank_data"
                data-id="{{ item.id }}"
                data-type="{{ item.type }}"
                data-technique="{{ item.technique.id }}"
                data-number="{{ item.number }}"
            ></li>
        {% endfor %}
        {% for item in combination_rank %}
            <li class="rank_data"
                data-id="{{ item.id }}"
                data-type="combination"
                data-technique1="{{ item.technique1.id }}"
                data-technique2="{{ item.technique2.id }}"
                data-number="{{ item.number }}"
            ></li>
        {% endfor %}
    </ul>
{% endblock %}

{% block opts_left %}{% if fighter.primary_side != 2 %} checked {% endif %}{% endblock %}

{% block opts_right %}{% if fighter.primary_side != 1 %} checked {% endif %}{% endblock %}

{% block buttons2 %}
    <button onclick="if (confirm('Wirklich löschen?')){ post_data('delete') }">Löschen</button>
    <button onclick="location.href = location.href">Zurücksetzen</button>
    <button onclick="post_data('save')">Speichern</button>
{% endblock %}

{% block script2 %}
    <script> 
        document.querySelectorAll(".pos_data").forEach(pos => {
            position = document.getElementById(pos.dataset["id"])
            position.style.display = "flex"
            colorSelected(position.className[0] + " " + position.className.slice(-1), "black")
            placeRelative(
                position,
                pos.dataset["y"],
                pos.dataset["x"]
            )
            position.addEventListener("mousedown", mouseDownPos)
            position.setAttribute("data-id", pos.dataset["model_id"])
        })

        document.querySelectorAll(".own_data").forEach(own => {
            add_own(parseInt(own.dataset["direction"]), own.dataset)
        })

        document.querySelectorAll(".rank_data").forEach(item => {
            add_rank_item(item.dataset["type"], item.dataset)
        })
    </script>
{% endblock %}
